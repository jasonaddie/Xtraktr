<%-
  label_key = "mongoid.attributes.help_page."
  hint_key = "mongoid.hints.help_page."
  a_label_key = "mongoid.attributes.help_page_assignment."
  a_hint_key = "mongoid.hints.help_page_assignment."
-%>

<%= semantic_form_for([:admin, @help_page], html: {class: 'tabbed-translation-form'}) do |f| %>
  <%= f.error_messages %>

  <%= f.inputs do %>
    <div class="row">
      <div class="col-sm-4">
        <%= f.input :permalink, hint: t(hint_key + 'permalink'), input_html: {size: 15} %>
      </div>
      <div class="col-sm-4">
        <%= f.input :sort_order, as: :number, hint: t(hint_key + 'sort_order'), min: 1, step: 5 %>
      </div>
      <div class="col-sm-4">
        <div class="radio_buttons input optional form-group" id="help_page_public_input">
          <label class="  control-label" for="help_page_public"><%= t(label_key + 'public') %><div class="help-inline" title="<%= t(hint_key + 'public') %>"><div>?</div></div>
          </label>
          <div class="radio">
            <label class="choice" for="help_page_public_true">
              <% checked = @help_page.public? ? 'checked=checked' : '' %>
              <input <%= checked %> id="help_page_public_true" name="help_page[public]" type="radio" value="true" />
              <%= t('formtastic.yes') %>
            </label>
          </div>
          <div class="radio">
            <label class="choice" for="help_page_public_false">
              <% checked = @help_page.public? ? '' : 'checked=checked' %>
              <input <%= checked %> id="help_page_public_false" name="help_page[public]" type="radio" value="false" />
              <%= t('formtastic.no') %>
            </label>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <div class="select input optional form-group" id="help_page_help_section_id_input">
          <label class="control-label" for="help_page_help_section_id"><%= t(label_key + 'help_section_id') %><div class="help-inline" title="<%= t(hint_key + 'help_section_id') %>"><div>?</div></div>
          </label>
          <select name="help_page[help_section_id]" id="help_page_help_section_id" class="selectpicker-help-page-help-section-id form-control" data-live-search="true" data-selected-text-format="count>3" data-size="7" data-width="72%">
            <option value=""></option>
            <%= build_help_section_ordered_select_options(@help_page.help_section_id).html_safe %>
          </select>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="radio_buttons input optional form-group" id="help_page_show_in_subnavbar_input">
          <label class="  control-label" for="help_page_show_in_subnavbar"><%= t(label_key + 'show_in_subnavbar') %><div class="help-inline" title="<%= t(hint_key + 'show_in_subnavbar') %>"><div>?</div></div>
          </label>
          <div class="radio">
            <label class="choice" for="help_page_show_in_subnavbar_true">
              <% checked = @help_page.show_in_subnavbar? ? 'checked=checked' : '' %>
              <input <%= checked %> id="help_page_show_in_subnavbar_true" name="help_page[show_in_subnavbar]" type="radio" value="true" />
              <%= t('formtastic.yes') %>
            </label>
          </div>
          <div class="radio">
            <label class="choice" for="help_page_show_in_subnavbar_false">
              <% checked = @help_page.show_in_subnavbar? ? '' : 'checked=checked' %>
              <input <%= checked %> id="help_page_show_in_subnavbar_false" name="help_page[show_in_subnavbar]" type="radio" value="false" />
              <%= t('formtastic.no') %>
            </label>
          </div>
        </div>
      </div>
    </div>
  <% end %>



  <div role="tabpanel" class="tabbed-translation-fields">
    <%
      locales = I18n.available_locales
    %>

    <ul class="nav nav-tabs" role="tablist"
        data-default-language-icon="<span class='glyphicon glyphicon-star' title='<%= t('helpers.default_language') %>'></span>">
      <%
        default_locale = I18n.default_locale.to_s
        default_lang = ''
      %>
      <% locales.each_with_index do |locale, index| %>
        <%
          lang = @languages.select{|x| x.locale == locale.to_s}.first
          cls = ''
          if index == 0
            cls = 'class=active'
            default_locale = locale
            default_lang = lang.present? ? lang.name : locale
          end
        %>
        <li role="presentation" <%= cls %> data-locale="<%= locale %>">
          <a href="#<%= locale %>" aria-controls="home" role="tab" data-toggle="tab">
            <%= lang.present? ? lang.name : locale %>
          </a>
        </li>
      <% end %>
    </ul>

    <div class="tab-content">
      <% locales.each_with_index do |locale, index| %>
        <%
          cls = ''
          cls = 'in active' if index == 0
        %>
        <div role="tabpanel" class="tab-pane fade <%= cls %>" id="<%= locale %>" data-locale="<%= locale %>">
          <%= f.fields_for :title_translations, OpenStruct.new(f.object.title_translations) do |translation| %>
            <%
              label = t(label_key + 'title')
              hint = t(hint_key + 'title')
              if index > 0
                label << show_default_text(@help_page.title_translations[default_locale])
              end
            %>
            <%= translation.input locale, hint: hint, label: label.html_safe %>
          <% end %>
          <%= f.fields_for :summary_translations, OpenStruct.new(f.object.summary_translations) do |translation| %>
            <%
              label = t(label_key + 'summary')
              hint = t(hint_key + 'summary')
              if index > 0
                label << show_default_text(@help_page.summary_translations[default_locale])
              end
            %>
            <%= translation.input locale, hint: hint, label: label.html_safe %>
          <% end %>
          <%= f.fields_for :content_translations, OpenStruct.new(f.object.content_translations) do |translation| %>
            <%
              label = t(label_key + 'content')
              hint = t(hint_key + 'content')
              if index > 0
                label << show_default_text(@help_page.content_translations[default_locale])
              end
            %>
            <%= translation.input locale, :as => :text, hint: hint, required: false, rows: 10, label: label.html_safe,
                :input_html => { class: "tinymce" } %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <hr />

  <h3><%= t('.assignments') %></h3>

  <p><%= t('.assignments_intro') %></p>

  <table id='help-page-assignments' class="table table-striped table-hover table-nonfluid">
    <thead>
      <tr>
        <th>
          <%= t(a_label_key + 'controller') %><abbr title="required">*</abbr><div class="help-inline" title="<%= t(a_hint_key + 'controller') %>"><div>?</div></div>
        </th>
        <th>
          <%= t(a_label_key + 'action') %><abbr title="required">*</abbr><div class="help-inline" title="<%= t(a_hint_key + 'action') %>"><div>?</div></div>
        </th>
        <th>
          <%= t(a_label_key + 'http_method') %><abbr title="required">*</abbr><div class="help-inline" title="<%= t(a_hint_key + 'http_method') %>"><div>?</div></div>
        </th>
        <th>
        </th>
      </tr>
    </thead>
    <tbody>
      <% @help_page.help_page_assignments.each do |assignment| %>
        <%= f.semantic_fields_for :help_page_assignments, assignment do |f_assignment| %>
          <%= render partial: 'help_page_assignment_fields', :locals => {:f => f_assignment} %>
        <% end %>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4">
          <%= link_to_add_association t('helpers.links.add_assignment'), f, :help_page_assignments,
              :class => 'btn btn-success',
              :'data-association-insertion-node' => 'table#help-page-assignments',
              :'data-association-insertion-method' => 'append' %>
        </td>
      </tr>
    </tfoot>
  </table>


  <div class="form-group">
    <%= f.submit nil, :class => 'btn btn-primary' %>
    <%= f.submit t('helpers.links.reset'), :class => 'btn btn-warning', :type => :reset, :name => :reset %>
    <%= link_to t('helpers.links.cancel'), admin_help_pages_path, :class => 'btn btn-warning' %>
  </div>
<% end %>

<%= tinymce_assets %>
